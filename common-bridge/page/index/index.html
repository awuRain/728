<link rel="import" href="/page/layout/header.html?__inline">

<p class="loading J-loading">正在加载中, 请耐心等待哟~</p>

<section class="page-container J-page-container">
    <section class="J-page page">
        <div class="J-placeholder J-placeholder-banner"></div>
        <div class="J-placeholder J-placeholder-footer">
            <footer>
                <div class="footer-cont-wrap">
                    <div class="footer-cont">
                        <a class="subSessionTab-btn">子会场</a>
                        <a class="game-btn">游戏</a>
                        <a class="mainSessionTab-btn">主会场</a>
                    </div>
                </div>
            </footer>
        </div>    
    </section>
</section>

<div class="J-placeholder J-placeholder-jumpBnr-rb"></div>
<span class="btn btn-toTop J-btn-toTop"></span>

<script type="text/template" id="tpl-layout">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
    %>
    <div class="J-placeholder J-placeholder-calendar"></div>
    <div class="J-placeholder J-placeholder-header"></div>
    <div class="J-placeholder J-placeholder-page-tab"></div>
    <div class="J-placeholder J-placeholder-coupon"></div>
    $${data.layout}
</script>

<script type="text/template" id="tpl-section">
    <%
        var arr_attrs = [];

        for(var attr in settings.attrs){
            arr_attrs.push(attr + '=' + settings.attrs[attr])
        }
    %>
    <section class="section-item section-item-${settings.id}" id="${settings.id}" ${arr_attrs.join(' ')}>
        <div class="section-item-hd">
            <h1 class="section-item-title">${settings.id}</h1>
            <p class="section-item-subTitle"><span>${settings.id}</span></p>
        </div>
        <div class="section-item-bd J-placeholder-${settings.id}">
            <div class="section-placeholder"></div>
        </div>
    </section>
</script>

<script type="text/template" id="tpl-ticketList">
    <%
        var arr_attrs = [],
            id, uid, td_id, grounpon_id, qunar_id, min_price, current_price, market_price, pic, title, city, saleNum, webappUrl, score,
            className;

        for(var attr in attrs){
            arr_attrs.push(attr + '=' + attrs[attr])
        }

        switch(type){
            case 'link': className = 'J-link'; break;
            case 'poi': className = 'J-poi'; break;
            case 'sku': className = 'J-sku'; break;
            default: className = '';
        }

        {# console.log('direction:',direction);
        console.log('type:',type);
        console.log('data:',data);
        console.log('attrs:',attrs);
        console.log('flags:',flags);}
    %>
    <ul ${arr_attrs.join(' ')}>
        {@each data as item, index}
            <%
                id = item.id || '';
                uid = item.poi_uid || '';
                td_id = item.td_id || '';
                grounpon_id = item.grounpon_id || '',
                qunar_id = item.qunar_id || '';
                min_price = item.min_price || 0;
                current_price = item.current_price || item.price || 0;
                market_price = item.market_price || item.ori_price || 0;
                pic = item.pic_url || item.image || item.pic || '';
                title = item.poi_name || item.title || '';
                city = item.city || '';
                saleNum = item.saleNum;
                webappUrl = item.webapp_url || '';
                score = item.score || 0;
            %>
            <li>
                <div class="ticket-item ${direction == 'vertical' ? 'ticket-item-v' : ''} ${className}" data-id="${id}" data-uid="${uid}" data-td_id="${td_id}" data-qunar_id="${qunar_id}" data-grounpon_id="${grounpon_id}" data-webappurl="${webappUrl}">
                    <div class="ticket-item-container">
                        {@if flags.length}
                            <p class="flag-wrap">
                                $${flags.join('')}
                            </p>
                        {@/if}
                        <div class="img-wrap">
                            <img src="${pic}" />
                            {@if direction == 'vertical'}
                                <div class="img-btm">
                                    <em>${city}</em>
                                    {@if score}
                                        <div class="stars-wrap">
                                            <div class="stars" data-stars="${score}"><span style="width:{score*2/10*100}%"></span></div>
                                        </div>
                                    {@/if}
                                </div>
                            {@/if}
                        </div>
                        <div class="ticket-main">
                            <div class="ticket-title">
                                {@if direction != 'vertical'}
                                    <em>${city}</em>
                                {@/if}
                                <p>${title}</p>
                            </div>
                            {@if direction != 'vertical'}
                                <div>
                                    <p class="ticket-saleInfo">限量??份</p>
                                </div>
                            {@/if}
                            <div class="price-wrap">
                                {@if direction == 'vertical'}
                                    <span class="price price-now price-floor"><em>${min_price}</em></span>
                                    <button class="btn-buy">抢购</button>
                                    <!-- <span class="price price-original price-marketPrice price-font10"><em>200</em></span> -->
                                {@else}
                                    <span class="price price-now price-discount"><em>??</em></span>
                                    <span class="price price-original price-originalPrice"><em>???</em></span>
                                    <!-- <span class="price price-now"><em>10</em></span>
                                        <span class="price price-original price-floor price-marketPrice price-font10"><em>200</em></span>
                                        <span class="price price-now price-nounit price-floor"><em>10</em></span>
                                        <span class="price price-original"><em>200</em></span>
                                        <span class="price price-now price-floor"><em>10</em></span>
                                        <span class="price price-original price-floor"><em>200</em></span>
                                        <span class="price price-now price-nounit"><em>10</em></span>
                                        <span class="price price-original price-floor price-nounit"><em>200</em></span>
                                        <span class="price price-original price-floor"><em>200</em></span>
                                        <span class="price price-original price-floor price-marketPrice"><em>200</em></span>
                                        <span class="price price-original price-floor price-marketPrice price-font10"><em>200</em></span>
                                        <span class="price price-original price-nounit"><em>200</em></span>
                                        <span class="price price-now price-discount"><em>10</em></span>
                                        <span class="price price-original"><em>200</em></span> -->
                                {@/if}
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        {@/each}
    </ul>
</script>

<script type="text/template" id="tpl-promotionList">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel,
            promotionList = cacheData.promotionList || {},
            promotionList_sid = promotionList[cacheData.sid] || {},
            promotionList_sid_list = promotionList_sid.list || [],
            startTime = 0,
            startDate,
            text;
    %>
    <div class="tab-hd">
        {@each promotionList_sid_list as item, index}
            <%
                startTime = item.start_time * 1000;
                startDate = new Date(startTime);

                if(item.status == 0) {
                    text = '即将开始'
                } else if(item.status == 1) {
                    text = '抢购中'
                } else if(item.status == 2) {
                    text = '抢购结束'
                }
            %>
            <button class="${item.status == 1 ? 'active' : ''}" tab-for="${data['tab' + (index - 0 + 1)].id}" tab-relFor="${data['tab' + (index - 0 + 1)].rel}"><em>${numFomat(startDate.getHours(), 2)}:${numFomat(startDate.getMinutes(), 2)}</em><span>${text}</span></button>
        {@/each}
    </div>
    <div class="BN-list">
        $${data.tab1.html}
        $${data.tab2.html}
        <p class="more-link">
            <img src="./img/temp/hehe.jpg">
        </p>
    </div>
</script>

<script type="text/template" id="tpl-mainMeeting">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
    %>
    <div class="BN-list BN-list-cols${data.colsNum}">
        $${data.list.html}
        <p class="more-link">
            <img src="./img/temp/hehe.jpg">
        </p>
    </div>
</script>

<script type="text/template" id="tpl-flayer">
    <%
        var pageConfig = cacheData.pageConfig,
            rulesText = cacheData.rulesText,
            channel = cacheData.channel,
            promotionList = cacheData.promotionList || {},
            promotionFixPrice = cacheData.promotionFixPrice || {},
            promotionFixPriceData = promotionFixPrice || {},
            ticket = promotionFixPriceData.ticket || {},
            domainList = cacheData.domainList || {},
            provinceList = domainList.province || [],
            cityList = domainList.city || [],
            flayerTitle = settings.flayerTitle || '',
            type = settings.type,
            data = settings.data || {};
    %>
    <section class="flayer flayer-${type}">
        <div class="flayer-container flex flex-v flex-pack-center">
            <span class="flayer-btn-close J-flayer-close"></span>
            {@if flayerTitle.length}
                <div class="flayer-hd">${flayerTitle}</div>
            {@/if}
            {@if type == 'couponPick'}
                <div class="flayer-bd">
                    {@if data.is_success == 0}
                        {@if data.err_msg}
                            <p>${data.err_msg}</p>
                        {@else}
                            <p>啊哦，领取失败<br>明天再来吧~
                            <p>（每人每种优惠券只能领用1张哦！）</p>
                        {@/if}
                    {@else}
                        <p>恭喜你~<br>领取成功~</p>
                    {@/if}
                    <span class="flayer-btn-ok J-flayer-close">我知道了</span>
                </div>
            {@else if type == 'domainList'}
                <div class="flayer-bd">
                    <div class="province-list">
                        <h3>城市</h3>
                        <ul>
                            {@each cityList as item, sid}
                                <li class="province-li ${item.city == cacheData.sname ? 'active' : ''}" data-sname="${item.city}" data-sid="${sid}">${item.city}</li>
                            {@/each}
                        </ul>
                    </div>
                    <div class="province-list">
                        <h3>省份</h3>
                        <ul>
                            {@each provinceList as sname, sid}
                                <li class="province-li ${sname == cacheData.sname ? 'active' : ''}" data-sname="${sname}" data-sid="${sid}">${sname}</li>
                            {@/each}
                        </ul>
                    </div>
                </div>
            {@else if type == 'help'}
                <div class="flayer-hd">活动详情</div>
                <div class="flayer-bd">
                    {@each rulesText as rule,index}
                        <p>${index-0+1}. ${rule}</p>
                    {@/each}
                </div>
            {@else if type == 'bookingTips'}
                <div class="flayer-hd">活动详情</div>
                <div class="flayer-bd">
                    {@each ticket.tips.tip.ResourceAddInfoList as item,index}
                        <p><strong>${item.SubTitle}</strong>${item.Description}</p>
                    {@/each}
                </div>
            {@/if}
        </div>
    </section>
</script>

<script type="text/template" id="tpl-header">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
        var test_headerPic = "http://hiphotos.baidu.com/baidu/pic/item/ae51f3deb48f8c54a16ca65d32292df5e0fe7f00.jpg";
    %>
    <header class="flex flex-align-center" style="background-image:url(${test_headerPic})">
        <h1 class="slogen">五一逍遥游 任性5.1GO</h1>
        <p class="btn-help"><span class="J-btn-help">活动规则</span></p>
    </header>
</script>

<script type="text/template" id="tpl-provinceSelect">
    <div class="province-select J-province-select">
        <p class="cur-province"><strong id="J_cur-pro">${cacheData.sname}</strong></p>
    </div>
</script>

<script type="text/template" id="tpl-calendar">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel,
            list = list;
        var baseOrder = [{
            id: 'scene_hotel',
            title: '景酒日游专题',
            meeting: '景酒',
            activeDate: '2016-07-16'
        }, {
            id: 'baby',
            title: '亲子专题',
            meeting: '亲自',
            activeDate: '2016-07-17'
        }, {
            id: 'qixi',
            title: '七夕专题',
            meeting: '七夕',
            activeDate: '2016-07-18'
        }, {
            id: 'slow_life',
            title: '慢生活专题',
            meeting: '慢生活',
            activeDate: '2016-07-19'
        }, {
            id: 'olympic',
            title: '奥运专题',
            meeting: '奥运',
            activeDate: '2016-07-20'
        }, {
            id: 'scenic',
            title: '名胜古迹',
            meeting: '名胜',
            activeDate: '2016-07-21'
        }];

    %>
    <section class="calendar">
        <div class="calendar-bd">
            <div class="list-header"></div>
            <div class="date-list-wrap">
                <div class="date-list">
                    <ul>
                        {@each baseOrder as item}
                            <li>
                                <div class="list-cont">
                                    <h1>${item.title}</h1>
                                    <h2>${item.activeDate | dateFomat}</h2>
                                </div>
                            </li>
                        {@/each}
                    </ul>
                </div>
            </div>
            
        </div>
    </section>
</script>

<script type="text/template" id="tpl-subSessionTab">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
    %>
    <section class="subSessionTab">
        <span class="close-btn">x</span>
    </section>
</script>

<script type="text/template" id="tpl-footer">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
    %>
    <footer>
        <div class="footer-cont-wrap">
            <div class="footer-cont">
                <a class="subSessionTab-btn">子会场</a>
                <a class="game-btn">游戏</a>
                <a class="mainSessionTab-btn">主会场</a>
            </div>
        </div>
    </footer>
</script>

<script type="text/template" id="tpl-banner">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel,
            bannerList = bannerList;
    %>
    <div class="section-item section-item-banner J-section-item-banner">

        <div class="section-item-hd">
            <h1 class="section-item-title">嗨玩精选不剁手</h1>
        </div>
        <ul>
            {@each bannerList as item}
                <li>
                    <a class="list-cont">
                        <div class="pic">
                            <i></i>
                        </div>
                        <div class="title">
                            <h1>${item.mainTitle}<h1>
                            <h2>${item.subTitle}</h2>
                        </div>
                    </a>
                </li>
            {@/each}
        </ul>
    </div>
</script>

<script type="text/template" id="tpl-coupon">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel,
            promotionIndex = cacheData.promotionIndex || {},
            mapDisCountStatus = cacheData.mapDisCountStatus || {},
            mapDisCountStatusItem,
            class_hot = 0,
            class_out = 0;
    %>

    {@if pageConfig.coupon.is_open == 1}
        <section class="coupon">
            {@if channel.name == 'nuomi'}
                <div class="coupon-cont">
                    <a class="coupon1"></a><a class="coupon2"></a>
                </div>
            {@else}
                <div class="coupon-cont">
                    <a class="coupon1"></a><a class="coupon2"></a>
                </div>
            {@/if}
        </section>
    {@/if}
</script>

<script type="text/template" id="tpl-pageTab">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;

        var baseOrder = [{
            id: 'scene_hotel',
            title: '景酒一日游专题',
            meeting: '景酒',
            activeDate: '2016-07-16'
        }, {
            id: 'baby',
            title: '亲子专题',
            meeting: '亲自',
            activeDate: '2016-07-17'
        }, {
            id: 'qixi',
            title: '七夕专题',
            meeting: '七夕',
            activeDate: '2016-07-18'
        }, {
            id: 'slow_life',
            title: '慢生活专题',
            meeting: '慢生活',
            activeDate: '2016-07-19'
        }, {
            id: 'olympic',
            title: '奥运专题',
            meeting: '奥运',
            activeDate: '2016-07-20'
        }, {
            id: 'scenic',
            title: '名胜古迹',
            meeting: '名胜',
            activeDate: '2016-07-21'
        }];

    %>
    {@if channel.name == 'nuomi'}
        <nav class="page-tab J-page-tab">
            <div class="tab-btn">

            </div>
            <div class="tab-list">
                <ul>
                    {@each baseOrder as item}
                        <li data-name="${item.name}" pb-id="${item['pb-id']}">
                            <h1>${item.title}</h1>
                        </li>
                    {@/each}
                </ul>
            </div>
        </nav>
    {@/if}
</script>

<script type="text/template" id="tpl-header">
    <%
        var pageConfig = cacheData.pageConfig,
            channel = cacheData.channel;
        var headerPic_test = 'http://hiphotos.baidu.com/baidu/pic/item/ae51f3deb48f8c54a16ca65d32292df5e0fe7f00.jpg';
    %>
    <header class="flex flex-align-center" style="background-image:url(${headerPic_test})"> 
        <h1 class="slogen">五一逍遥游 任性5.1GO</h1>
        <p class="btn-help"><span class="J-btn-help">活动规则</span></p>
    </header>
</script>

<script>
ready(function() {
    require.async('./index.js');
});
</script>
<link rel="import" href="/page/layout/footer.html?__inline">
